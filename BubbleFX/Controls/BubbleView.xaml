<UserControl x:Class="VisualBuffer.BubbleFX.Controls.BubbleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             MinWidth="220" MinHeight="170">
    <!-- Root — тащим за весь пузырь; ещё в коде подписываемся на MouseEnter/Leave -->
    <Border x:Name="Root"
            CornerRadius="20"
            Background="Transparent"
            BorderBrush="Transparent"
            BorderThickness="2">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="25"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="30"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="30"/>
            </Grid.ColumnDefinitions>

            <!-- PIN (слева) -->
            <Border Grid.Column="0" Grid.Row="0" CornerRadius="15,0,0,0"
                    Background="#4f4f4f" BorderBrush="#9AA0A6" BorderThickness="1,1,0,0">
                <Button x:Name="PinBtn"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Click="PinBtn_Click"
                        ToolTip="Заблокировать/разблокировать пузырь">
                    <Image x:Name="PinIcon"
                           Width="20" Height="20" Margin="3,3,2,3"
                           Source="/Resources/transparentPin.png"
                           RenderTransformOrigin="0.5,0.5"/>
                </Button>
            </Border>

            <!-- Заголовок -->
            <Border x:Name="HeaderTitleArea"
                    Grid.Column="1" Grid.Row="0" Grid.ColumnSpan="5"
                    Background="#9AA0A6">
                <Grid>
                    <TextBlock x:Name="TitleText"
                               Text="{Binding Title}"
                               TextAlignment="Left"
                               Margin="30,0,8,0"
                               VerticalAlignment="Center"
                               FontSize="15"
                               FontFamily="Cascadia Code"
                               Foreground="Beige"
                               MouseLeftButtonDown="TitleText_MouseLeftButtonDown"/>
                    <TextBox x:Name="TitleEdit"
                             Visibility="Collapsed"
                             Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Margin="28,2,6,2"
                             FontSize="15"
                             FontFamily="Cascadia Code"
                             Foreground="Beige"
                             Background="#333333"
                             BorderBrush="#FFFFFF"
                             VerticalContentAlignment="Center"
                             KeyDown="TitleEdit_KeyDown"
                             LostKeyboardFocus="TitleEdit_LostKeyboardFocus"/>
                </Grid>
            </Border>

            <!-- Закрыть -->
            <Border x:Name="CloseArea"
                    Grid.Column="6" Grid.Row="0"
                    CornerRadius="0,15,0,0"
                    Background="#C83A3A" BorderBrush="#9AA0A6" BorderThickness="0,1,1,0">
                <Button x:Name="CloseBtn"
                        Background="Transparent"
                        Content="✕" Margin="0"
                        Foreground="#9AA0A6"
                        VerticalAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        Click="CloseBtn_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="BorderBrush" Value="Transparent"/>
                        </Style>
                    </Button.Style>
                </Button>
            </Border>

            <!-- Контент -->
            <Border x:Name="ContentArea"
                    Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="7"
                    CornerRadius="0,0,15,15"
                    BorderThickness="1" BorderBrush="#9AA0A6"
                    Background="#6b6b6b" Padding="6">
                <ScrollViewer VerticalScrollBarVisibility="Hidden" CanContentScroll="True" IsHitTestVisible="False">
                    <TextBlock Foreground="Beige"
                               TextWrapping="Wrap"
                               FontSize="13"
                               FontWeight="Light"
                               FontFamily="Cascadia Code"
                               Text="{Binding ContentText}"
                               Margin="5"/>
                </ScrollViewer>
            </Border>
        </Grid>
    </Border>
</UserControl>
