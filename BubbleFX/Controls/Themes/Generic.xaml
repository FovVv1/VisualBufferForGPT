<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:VisualBuffer.BubbleFX.Controls"
    xmlns:primitives="clr-namespace:VisualBuffer.BubbleFX.Primitives"
    xmlns:panels="clr-namespace:VisualBuffer.BubbleFX.Panels"
    xmlns:System="clr-namespace:System;assembly=mscorlib">

    <!-- Крошечная «прозрачная» кнопка без хрома -->
    <Style x:Key="GhostButton" TargetType="Button">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Стиль для заголовка над пузырём -->
    <Style x:Key="ArcTitleText" TargetType="TextBlock">
        <Setter Property="Foreground" Value="#E0E0E0"/>
        <Setter Property="FontFamily" Value="Cascadia Code"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
    </Style>

    <Style TargetType="{x:Type controls:BubbleCircleView}">
        <!-- дефолтные визуальные значения -->
        <Setter Property="Foreground" Value="Beige"/>
        <Setter Property="FontFamily" Value="Cascadia Code"/>
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="Padding" Value="10"/>

        <!-- управляем габаритом через DP Diameter -->
        <Setter Property="Width"  Value="{Binding RelativeSource={RelativeSource Self}, Path=Diameter}"/>
        <Setter Property="Height" Value="{Binding RelativeSource={RelativeSource Self}, Path=Diameter}"/>

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type controls:BubbleCircleView}">
                    <Grid Background="Transparent" SnapsToDevicePixels="True">
                        <!-- Визуальная подложка круга -->
                        <Ellipse
                            IsHitTestVisible="False"
                            Width="{TemplateBinding Diameter}"
                            Height="{TemplateBinding Diameter}"
                            Fill="{TemplateBinding BubbleBackground}"
                            Stroke="{TemplateBinding BubbleOutline}"
                            StrokeThickness="2"/>

                        <!-- Хиттест и клип строго по кругу -->
                        <primitives:CircleHitTestDecorator
                            Width="{TemplateBinding Diameter}"
                            Height="{TemplateBinding Diameter}"
                            EnableClip="True"
                            Inset="0">
                            <Border Padding="{TemplateBinding Padding}" Background="{x:Null}">
                                <ScrollViewer
                                    x:Name="PART_Scroll"
                                    VerticalScrollBarVisibility="Auto"
                                    HorizontalScrollBarVisibility="Disabled"
                                    CanContentScroll="False"
                                    Focusable="False">
                                    <TextBlock
                                        x:Name="PART_Text"
                                        Text="{TemplateBinding Text}"
                                        Foreground="{TemplateBinding Foreground}"
                                        TextWrapping="Wrap"
                                        TextTrimming="CharacterEllipsis"
                                        FontFamily="{TemplateBinding FontFamily}"
                                        FontSize="{TemplateBinding FontSize}"/>
                                </ScrollViewer>
                            </Border>
                        </primitives:CircleHitTestDecorator>

                        <!-- === ПОЛУДУГА СВЕРХУ: кнопки + заголовок === -->
                        <panels:PolarPanel
                            IsHitTestVisible="True"
                            Radius="120"
                            StartAngleDeg="200"
                            EndAngleDeg="-20">

                            <!-- Левая кнопка (Pin) -->
                            <Button x:Name="PART_PinButton"
                                    Style="{StaticResource GhostButton}"
                                    panels:PolarPanel.Angle="{x:Static System:Double.NaN}">
                                <Viewbox Width="18" Height="18">
                                    <TextBlock Text="📌"/>
                                </Viewbox>
                            </Button>

                            <!-- Заголовок по центру дуги -->
                            <Border Padding="4,2" Background="#3A3A3A" CornerRadius="6">
                                <!-- ТЕПЕРЬ берём из DP Title -->
                                <TextBlock Text="{TemplateBinding Title}"
                                           MinWidth="80"
                                           HorizontalAlignment="Center"
                                           TextAlignment="Center"
                                           Style="{StaticResource ArcTitleText}"/>
                            </Border>

                            <!-- Правая кнопка (Close) -->
                            <Button x:Name="PART_CloseButton"
                                    Style="{StaticResource GhostButton}">
                                <Viewbox Width="16" Height="16">
                                    <TextBlock Text="✕" Foreground="#FF4D4D"/>
                                </Viewbox>
                            </Button>

                        </panels:PolarPanel>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>
